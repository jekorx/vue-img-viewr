var e=Object.defineProperty,n=Object.prototype.hasOwnProperty,i=Object.getOwnPropertySymbols,o=Object.prototype.propertyIsEnumerable,l=(n,i,o)=>i in n?e(n,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[i]=o,t=(e,t)=>{for(var s in t||(t={}))n.call(t,s)&&l(e,s,t[s]);if(i)for(var s of i(t))o.call(t,s)&&l(e,s,t[s]);return e};import{defineComponent as s,ref as a,reactive as r,computed as c,watch as d,nextTick as u,onMounted as m,onBeforeUnmount as g,openBlock as v,createBlock as _,Transition as w,withCtx as p,withDirectives as f,createVNode as h,withModifiers as b,Fragment as k,createCommentVNode as y,renderList as x,vShow as I,resolveComponent as C,render as A}from"vue";const O="undefined"==typeof window,z=(e,n,i,o=!1)=>{!O&&e&&n&&i&&e.addEventListener(n,i,o)},M=(e,n,i,o=!1)=>{!O&&e&&n&&i&&e.removeEventListener(n,i,o)};function S(e){let n=!1;return function(...i){n||(n=!0,window.requestAnimationFrame((()=>{e.apply(this,i),n=!1})))}}const E={CONTAIN:{name:"contain",icon:"img-viewr__icon icon__full-screen"},ORIGINAL:{name:"original",icon:"img-viewr__icon icon__scale-to-original"}},D=!O&&window.navigator.userAgent.match(/firefox/i)?"DOMMouseScroll":"mousewheel",L="Escape",N="ArrowLeft",T="ArrowUp",R="ArrowRight",$="ArrowDown",F="Space";var X=s({props:{visible:{type:Boolean,default:!1},urls:{type:Array,default:()=>[]},zIndex:{type:Number,default:3e3},initialIndex:{type:Number,default:0},lockScroll:{type:Boolean,default:!0},closeOnClickMask:{type:Boolean,default:!0}},emits:["close","switch"],setup(e,{emit:n}){const i=a(0),o=a(!0),l=a(!1),s=r(t({},E.CONTAIN)),v=r({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),_=a(null),w=a(null),p=c((()=>e.urls.length<=1)),f=c((()=>0===i.value)),h=c((()=>i.value===e.urls.length-1)),b=c((()=>e.urls[i.value]||e.urls[0])),k=c((()=>{const{scale:e,deg:n,offsetX:i,offsetY:o,enableTransition:l}=v,t={transform:`scale(${e}) rotate(${n}deg)`,transition:l?"transform .3s":"","margin-left":`${i}px`,"margin-top":`${o}px`};return s.name===E.CONTAIN.name&&(t.maxWidth=t.maxHeight="100%"),t}));d((()=>e.initialIndex),(e=>{e!==i.value&&(i.value=e)})),d(i,(e=>{A(),n("switch",e)})),d(b,(()=>{u((()=>{const e=w.value;e&&e.complete||(l.value=!0)}))})),d((()=>e.visible),(n=>{if(!e.lockScroll)return;let i=document.body.className;n?i.includes("img-viewr__body-lock")||(i+=" img-viewr__body-lock"):i=i.replace("img-viewr__body-lock",""),document.body.className=i.trim()}));const y=()=>{n("close")};let x,I,C;const A=()=>{v.scale=1,v.deg=0,v.offsetX=0,v.offsetY=0,v.enableTransition=!1},O=()=>{if(l.value)return;const e=Object.keys(E),n=(Object.values(E).findIndex((({name:e})=>e===s.name))+1)%e.length,{name:i,icon:o}=E[e[n]];s.name=i,s.icon=o,A()},X=()=>{if(f.value&&!o.value)return;const n=e.urls.length;i.value=(i.value-1+n)%n},Y=()=>{if(h.value&&!o.value)return;const n=e.urls.length;i.value=(i.value+1)%n},j=(e,n={})=>{if(l.value)return;const{zoomRate:i,rotateDeg:o,enableTransition:s}=t({zoomRate:.2,rotateDeg:90,enableTransition:!0},n);switch(e){case"zoomOut":v.scale>.2&&(v.scale=parseFloat((v.scale-i).toFixed(3)));break;case"zoomIn":v.scale=parseFloat((v.scale+i).toFixed(3));break;case"clocelise":v.deg+=o;break;case"anticlocelise":v.deg-=o;break;case"download":((e,n,i)=>{const o=new Image,l=document.createElement("canvas"),t=l.getContext("2d"),s=document.createElement("a");o.setAttribute("crossOrigin","anonymous"),o.src=e,o.onerror=()=>{window.open(e)},o.onload=()=>{l.width=o.width,l.height=o.height,null==t||t.drawImage(o,0,0,o.width,o.height),s.setAttribute("href",l.toDataURL(`image/${i}`)),s.setAttribute("target","_blank"),s.setAttribute("download",`${n}.${i}`),s.click()}})(b.value,Date.now().toString(),"png")}v.enableTransition=s};return m((()=>{var e;x=S((e=>{switch(e.code){case L:y();break;case F:O();break;case N:X();break;case T:j("zoomIn");break;case R:Y();break;case $:j("zoomOut")}})),I=S((e=>{const n=e.wheelDelta?e.wheelDelta:-e.detail;j(n>0?"zoomIn":"zoomOut",{zoomRate:.05,enableTransition:!1})})),z(document,"keydown",x),z(document,D,I),null==(e=null==_?void 0:_.value)||e.focus()})),g((()=>{x&&M(document,"keydown",x),I&&M(document,D,I),x=null,I=null})),{imgViewrWrapper:_,imageRef:w,index:i,isSingle:p,infinite:o,isFirst:f,isLast:h,mode:s,currentImg:b,imgStyle:k,hide:y,prev:X,next:Y,toggleMode:O,handleActions:j,handleMaskClick:()=>{e.closeOnClickMask&&y()},handleImgLoad:()=>{l.value=!1},handleImgError:()=>{l.value=!1;const e=w.value;e&&(e.alt="加载失败")},handleMouseDown:e=>{if(l.value||0!==e.button)return;const{offsetX:n,offsetY:i}=v,o=e.pageX,t=e.pageY;C=S((e=>{v.offsetX=n+e.pageX-o,v.offsetY=i+e.pageY-t})),z(document,"mousemove",C),z(document,"mouseup",(()=>{C&&M(document,"mousemove",C)})),e.preventDefault()}}}});const Y=h("i",{class:"img-viewr__icon icon__circle-close"},null,-1),j=h("i",{class:"img-viewr__icon icon__arrow-left"},null,-1),V=h("i",{class:"img-viewr__icon icon__arrow-right"},null,-1),W={class:"img-viewr__btn img-viewr__actions"},B={class:"img-viewr__actions__inner"},P=h("i",{class:"img-viewr__actions__divider"},null,-1),U=h("i",{class:"img-viewr__actions__divider"},null,-1),q=h("i",{class:"img-viewr__actions__divider"},null,-1),G={class:"img-viewr__canvas"};X.render=function(e,n,i,o,l,t){return v(),_(w,{name:"img-viewr-fade"},{default:p((()=>[f(h("div",{tabindex:"-1",ref:"imgViewrWrapper",class:"img-viewr__wrapper",style:`z-index: ${e.zIndex}`},[h("div",{class:"img-viewr__mask",onClick:n[1]||(n[1]=b(((...n)=>e.handleMaskClick&&e.handleMaskClick(...n)),["self"]))}),h("span",{class:"img-viewr__btn img-viewr__close",onClick:n[2]||(n[2]=(...n)=>e.hide&&e.hide(...n))},[Y]),e.isSingle?y("",!0):(v(),_(k,{key:0},[h("span",{class:["img-viewr__btn img-viewr__prev",{"is-disabled":!e.infinite&&e.isFirst}],onClick:n[3]||(n[3]=(...n)=>e.prev&&e.prev(...n))},[j],2),h("span",{class:["img-viewr__btn img-viewr__next",{"is-disabled":!e.infinite&&e.isLast}],onClick:n[4]||(n[4]=(...n)=>e.next&&e.next(...n))},[V],2)],64)),h("div",W,[h("div",B,[h("i",{class:"img-viewr__icon icon__zoom-out",onClick:n[5]||(n[5]=n=>e.handleActions("zoomOut"))}),h("i",{class:"img-viewr__icon icon__zoom-in",onClick:n[6]||(n[6]=n=>e.handleActions("zoomIn"))}),P,h("i",{class:e.mode.icon,onClick:n[7]||(n[7]=(...n)=>e.toggleMode&&e.toggleMode(...n))},null,2),U,h("i",{class:"img-viewr__icon icon__download-image",onClick:n[8]||(n[8]=n=>e.handleActions("download"))}),q,h("i",{class:"img-viewr__icon icon__refresh-left",onClick:n[9]||(n[9]=n=>e.handleActions("anticlocelise"))}),h("i",{class:"img-viewr__icon icon__refresh-right",onClick:n[10]||(n[10]=n=>e.handleActions("clocelise"))})])]),h("div",G,[(v(!0),_(k,null,x(e.urls,((i,o)=>(v(),_(k,null,[o===e.index?(v(),_("img",{class:"img-viewr__img",ref:"imageRef",key:i,src:e.currentImg,style:e.imgStyle,onLoad:n[11]||(n[11]=(...n)=>e.handleImgLoad&&e.handleImgLoad(...n)),onError:n[12]||(n[12]=(...n)=>e.handleImgError&&e.handleImgError(...n)),onMousedown:n[13]||(n[13]=(...n)=>e.handleMouseDown&&e.handleMouseDown(...n))},null,44,["src"])):y("",!0)],64)))),256))])],4),[[I,e.visible]])])),_:1})};var H={name:"Wrap",components:{ImgViewr:X},setup(){const e=r({visible:!1,lockScroll:!0,closeOnClickMask:!0,urls:[],index:0,zIndex:3e3,onClose(){},onSwitch(e){}});return{options:e,close:()=>{e.visible=!1,setTimeout((()=>{e.urls=[],null==e||e.onClose()}),300)},change:n=>{e.onSwitch(n)}}}};H.render=function(e,n,i,o,l,t){const s=C("ImgViewr");return v(),_(s,{visible:o.options.visible,urls:o.options.urls,"initial-index":o.options.index,"z-index":o.options.zIndex,"lock-scroll":o.options.lockScroll,"close-on-clickMask":o.options.closeOnClickMask,onClose:o.close,onSwitch:o.change},null,8,["visible","urls","initial-index","z-index","lock-scroll","close-on-clickMask","onClose","onSwitch"])};const J="undefined"==typeof window;let K;const Q=e=>{if(!J){if(!(e.urls&&e.urls.length>0))throw new Error("At least one picture in urls array!");K||(()=>{const e=document.createElement("div"),n=h(H,{});n&&n.props&&(n.props.onDestroy=()=>{A(null,e)}),A(n,e),K=n,e.firstElementChild&&document.body.appendChild(e.firstElementChild)})();for(const n in e)K.component.proxy.options[n]=e[n];K.component.proxy.options.visible=!0}};export{X as ImgViewr,Q as showImages};
