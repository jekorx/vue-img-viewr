var e=Object.defineProperty,n=Object.prototype.hasOwnProperty,l=Object.getOwnPropertySymbols,i=Object.prototype.propertyIsEnumerable,o=(n,l,i)=>l in n?e(n,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[l]=i,a=(e,a)=>{for(var t in a||(a={}))n.call(a,t)&&o(e,t,a[t]);if(l)for(var t of l(a))i.call(a,t)&&o(e,t,a[t]);return e};import{defineComponent as t,ref as s,reactive as r,computed as c,watchEffect as u,watch as d,nextTick as m,onMounted as v,onBeforeUnmount as g,openBlock as w,createBlock as _,Transition as f,withCtx as h,withDirectives as p,createVNode as k,withModifiers as b,Fragment as y,createCommentVNode as I,renderList as x,vShow as C,render as O}from"vue";const A="undefined"==typeof window,z=(e,n,l,i=!1)=>{!A&&e&&n&&l&&e.addEventListener(n,l,i)},S=(e,n,l,i=!1)=>{!A&&e&&n&&l&&e.removeEventListener(n,l,i)};function M(e){let n=!1;return function(...l){n||(n=!0,window.requestAnimationFrame((()=>{e.apply(this,l),n=!1})))}}const E={CONTAIN:{name:"contain",icon:"img-viewr__icon icon__full-screen"},ORIGINAL:{name:"original",icon:"img-viewr__icon icon__scale-to-original"}},L=!A&&window.navigator.userAgent.match(/firefox/i)?"DOMMouseScroll":"mousewheel",D="Escape",N="ArrowLeft",T="ArrowUp",$="ArrowRight",R="ArrowDown",F="Space";var H=t({name:"ImgViewr",props:{visible:{type:Boolean,default:!1},urls:{type:Array,default:()=>[]},zIndex:{type:Number,default:3e3},initialIndex:{type:Number,default:0},lockScroll:{type:Boolean,default:!0},closeOnClickMask:{type:Boolean,default:!0}},emits:["close","switch","show"],setup(e,{emit:n}){const l=s(0),i=s(3e3),o=s(!0),t=s(!0),w=s(!1),_=s([]),f=s(null),h=s(null),p=s(null),k=s(0),b=s(!0),y=s(!1),I=r(a({},E.CONTAIN)),x=r({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),C=s(null),O=s(null),A=c((()=>_.value.length<=1)),H=c((()=>0===k.value)),X=c((()=>k.value===_.value.length-1)),Y=c((()=>_.value[k.value]||_.value[0])),j=c((()=>{const{scale:e,deg:n,offsetX:l,offsetY:i,enableTransition:o}=x,a={transform:`scale(${e}) rotate(${n}deg)`,transition:o?"transform .3s":"","margin-left":`${l}px`,"margin-top":`${i}px`};return I.name===E.CONTAIN.name&&(a.maxWidth=a.maxHeight="100%"),a}));u((()=>{e.urls.length&&(_.value=e.urls,l.value=e.initialIndex,i.value=e.zIndex,o.value=e.lockScroll,t.value=e.closeOnClickMask)})),d((()=>e.visible),(e=>{w.value=e})),d(l,(e=>{e!==k.value&&(k.value=e)})),d(w,(e=>{var l;if(!o.value)return;const i=document.body.classList;e?(U(),i.contains("img-viewr__body-lock")||i.add("img-viewr__body-lock")):i.contains("img-viewr__body-lock")&&i.remove("img-viewr__body-lock"),null==(l=p.value)||l.call(p,e),n("show",e)})),d(k,(e=>{var l;U(),null==(l=h.value)||l.call(h,e),n("switch",e)})),d(Y,(()=>{m((()=>{const e=O.value;e&&e.complete||(y.value=!0)}))}));const P=()=>{var e;null==(e=f.value)||e.call(f),n("close")};let V,B,W;const U=()=>{x.scale=1,x.deg=0,x.offsetX=0,x.offsetY=0,x.enableTransition=!1},q=()=>{if(y.value)return;const e=Object.keys(E),n=(Object.values(E).findIndex((({name:e})=>e===I.name))+1)%e.length,{name:l,icon:i}=E[e[n]];I.name=l,I.icon=i,U()},G=()=>{if(H.value&&!b.value)return;const e=_.value.length;k.value=(k.value-1+e)%e},J=()=>{if(X.value&&!b.value)return;const e=_.value.length;k.value=(k.value+1)%e},K=(e,n={})=>{if(y.value)return;const{zoomRate:l,rotateDeg:i,enableTransition:o}=a({zoomRate:.2,rotateDeg:90,enableTransition:!0},n);switch(e){case"zoomOut":x.scale>.2&&(x.scale=parseFloat((x.scale-l).toFixed(3)));break;case"zoomIn":x.scale=parseFloat((x.scale+l).toFixed(3));break;case"clocelise":x.deg+=i;break;case"anticlocelise":x.deg-=i;break;case"download":((e,n,l)=>{const i=new Image,o=document.createElement("canvas"),a=o.getContext("2d"),t=document.createElement("a");i.setAttribute("crossOrigin","anonymous"),i.src=e,i.onerror=()=>{window.open(e)},i.onload=()=>{o.width=i.width,o.height=i.height,null==a||a.drawImage(i,0,0,i.width,i.height),t.setAttribute("href",o.toDataURL(`image/${l}`)),t.setAttribute("target","_blank"),t.setAttribute("download",`${n}.${l}`),t.click()}})(Y.value,Date.now().toString(),"png")}x.enableTransition=o};return v((()=>{var e,n;V=M((e=>{switch(e.code){case D:P();break;case F:q();break;case N:G();break;case T:K("zoomIn");break;case $:J();break;case R:K("zoomOut")}})),B=M((e=>{const n=e.wheelDelta?e.wheelDelta:-e.detail;K(n>0?"zoomIn":"zoomOut",{zoomRate:.05,enableTransition:!1})})),z(document,"keydown",V),z(document,L,B),null==(n=null==(e=null==C?void 0:C.value)?void 0:e.focus)||n.call(e)})),g((()=>{V&&S(document,"keydown",V),B&&S(document,L,B),V=null,B=null})),{images:_,isShow:w,initIndex:l,zIndexNum:i,isLockScroll:o,isCloseOnClickMask:t,imgViewrWrapper:C,imageRef:O,index:k,isSingle:A,infinite:b,isFirst:H,isLast:X,mode:I,currentImg:Y,imgStyle:j,closeHandle:f,switchHandle:h,showHandle:p,hide:P,prev:G,next:J,toggleMode:q,handleActions:K,handleMaskClick:()=>{t.value&&P()},handleImgLoad:()=>{y.value=!1},handleImgError:()=>{y.value=!1;const e=O.value;e&&(e.alt="加载失败")},handleMouseDown:e=>{if(y.value||0!==e.button)return;const{offsetX:n,offsetY:l}=x,i=e.pageX,o=e.pageY;W=M((e=>{x.offsetX=n+e.pageX-i,x.offsetY=l+e.pageY-o})),z(document,"mousemove",W),z(document,"mouseup",(()=>{W&&S(document,"mousemove",W)})),e.preventDefault()}}}});const X=k("i",{class:"img-viewr__icon icon__circle-close"},null,-1),Y=k("i",{class:"img-viewr__icon icon__arrow-left"},null,-1),j=k("i",{class:"img-viewr__icon icon__arrow-right"},null,-1),P={class:"img-viewr__btn img-viewr__actions"},V={class:"img-viewr__actions__inner"},B=k("i",{class:"img-viewr__actions__divider"},null,-1),W=k("i",{class:"img-viewr__actions__divider"},null,-1),U=k("i",{class:"img-viewr__actions__divider"},null,-1),q={class:"img-viewr__canvas"};H.render=function(e,n,l,i,o,a){return w(),_(f,{name:"img-viewr-fade"},{default:h((()=>[p(k("div",{tabindex:"-1",ref:"imgViewrWrapper",class:"img-viewr__wrapper",style:`z-index: ${e.zIndexNum}`},[k("div",{class:"img-viewr__mask",onClick:n[1]||(n[1]=b(((...n)=>e.handleMaskClick&&e.handleMaskClick(...n)),["self"]))}),k("span",{class:"img-viewr__btn img-viewr__close",onClick:n[2]||(n[2]=(...n)=>e.hide&&e.hide(...n))},[X]),e.isSingle?I("",!0):(w(),_(y,{key:0},[k("span",{class:["img-viewr__btn img-viewr__prev",{"is-disabled":!e.infinite&&e.isFirst}],onClick:n[3]||(n[3]=(...n)=>e.prev&&e.prev(...n))},[Y],2),k("span",{class:["img-viewr__btn img-viewr__next",{"is-disabled":!e.infinite&&e.isLast}],onClick:n[4]||(n[4]=(...n)=>e.next&&e.next(...n))},[j],2)],64)),k("div",P,[k("div",V,[k("i",{class:"img-viewr__icon icon__zoom-out",onClick:n[5]||(n[5]=n=>e.handleActions("zoomOut"))}),k("i",{class:"img-viewr__icon icon__zoom-in",onClick:n[6]||(n[6]=n=>e.handleActions("zoomIn"))}),B,k("i",{class:e.mode.icon,onClick:n[7]||(n[7]=(...n)=>e.toggleMode&&e.toggleMode(...n))},null,2),W,k("i",{class:"img-viewr__icon icon__download-image",onClick:n[8]||(n[8]=n=>e.handleActions("download"))}),U,k("i",{class:"img-viewr__icon icon__refresh-left",onClick:n[9]||(n[9]=n=>e.handleActions("anticlocelise"))}),k("i",{class:"img-viewr__icon icon__refresh-right",onClick:n[10]||(n[10]=n=>e.handleActions("clocelise"))})])]),k("div",q,[(w(!0),_(y,null,x(e.images,((l,i)=>(w(),_(y,null,[i===e.index?(w(),_("img",{class:"img-viewr__img",ref:"imageRef",key:l,src:e.currentImg,style:e.imgStyle,onLoad:n[11]||(n[11]=(...n)=>e.handleImgLoad&&e.handleImgLoad(...n)),onError:n[12]||(n[12]=(...n)=>e.handleImgError&&e.handleImgError(...n)),onMousedown:n[13]||(n[13]=(...n)=>e.handleMouseDown&&e.handleMouseDown(...n))},null,44,["src"])):I("",!0)],64)))),256))])],4),[[C,e.isShow]])])),_:1})};const G="undefined"==typeof window;let J;const K=e=>{var n,l,i,o,a;if(G)return;if(!(e.urls&&e.urls.length>0))throw new Error("At least one picture in urls array!");J||(()=>{const e=document.createElement("div"),n=k(H,{});n&&n.props&&(n.props.onDestroy=()=>{O(null,e)}),O(n,e),J=n,e.firstElementChild&&document.body.appendChild(e.firstElementChild)})();const t=null==(n=null==J?void 0:J.component)?void 0:n.proxy;t.images=e.urls,t.initIndex=null!=(l=e.index)?l:0,t.zIndexNum=null!=(i=e.zIndex)?i:3e3,t.isLockScroll=null==(o=e.lockScroll)||o,t.isCloseOnClickMask=null==(a=e.closeOnClickMask)||a,t.closeHandle=()=>{var n;t.isShow=!1,null==(n=e.onClose)||n.call(e)},t.switchHandle=n=>{var l;null==(l=e.onSwitch)||l.call(e,n)},t.showHandle=n=>{var l;null==(l=e.onShow)||l.call(e,n)},setTimeout((()=>{t.isShow=!0}),0)};H.showImages=K,H.install=e=>{e.config.globalProperties.$showImages=K,e.component(H.name,H)};export default H;export{H as ImgViewr,K as showImages};
