var e=Object.defineProperty,n=Object.prototype.hasOwnProperty,l=Object.getOwnPropertySymbols,i=Object.prototype.propertyIsEnumerable,o=(n,l,i)=>l in n?e(n,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[l]=i,a=(e,a)=>{for(var t in a||(a={}))n.call(a,t)&&o(e,t,a[t]);if(l)for(var t of l(a))i.call(a,t)&&o(e,t,a[t]);return e};import{defineComponent as t,ref as s,reactive as r,computed as c,watchEffect as u,watch as d,nextTick as m,onMounted as v,onBeforeUnmount as g,openBlock as w,createBlock as _,Transition as f,withCtx as h,withDirectives as p,createVNode as b,withModifiers as k,Fragment as y,createCommentVNode as I,renderList as x,vShow as C,render as O}from"vue";const A="undefined"==typeof window,z=(e,n,l,i=!1)=>{!A&&e&&n&&l&&e.addEventListener(n,l,i)},S=(e,n,l,i=!1)=>{!A&&e&&n&&l&&e.removeEventListener(n,l,i)};function M(e){let n=!1;return function(...l){n||(n=!0,window.requestAnimationFrame((()=>{e.apply(this,l),n=!1})))}}const E={CONTAIN:{name:"contain",icon:"img-viewr__icon icon__full-screen"},ORIGINAL:{name:"original",icon:"img-viewr__icon icon__scale-to-original"}},N=!A&&window.navigator.userAgent.match(/firefox/i)?"DOMMouseScroll":"mousewheel",D="Escape",L="ArrowLeft",T="ArrowUp",$="ArrowRight",R="ArrowDown",F="Space";var X=t({name:"ImgViewr",props:{visible:{type:Boolean,default:!1},urls:{type:Array,default:()=>[]},zIndex:{type:Number,default:3e3},initialIndex:{type:Number,default:0},lockScroll:{type:Boolean,default:!0},closeOnClickMask:{type:Boolean,default:!0}},emits:["close","switch"],setup(e,{emit:n}){const l=s(0),i=s(3e3),o=s(!0),t=s(!0),w=s(!1),_=s([]),f=s(null),h=s(null),p=s(0),b=s(!0),k=s(!1),y=r(a({},E.CONTAIN)),I=r({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),x=s(null),C=s(null),O=c((()=>_.value.length<=1)),A=c((()=>0===p.value)),X=c((()=>p.value===_.value.length-1)),Y=c((()=>_.value[p.value]||_.value[0])),j=c((()=>{const{scale:e,deg:n,offsetX:l,offsetY:i,enableTransition:o}=I,a={transform:`scale(${e}) rotate(${n}deg)`,transition:o?"transform .3s":"","margin-left":`${l}px`,"margin-top":`${i}px`};return y.name===E.CONTAIN.name&&(a.maxWidth=a.maxHeight="100%"),a}));u((()=>{e.urls.length&&(_.value=e.urls,l.value=e.initialIndex,i.value=e.zIndex,o.value=e.lockScroll,t.value=e.closeOnClickMask)})),d((()=>e.visible),(e=>{w.value=e})),d(l,(e=>{e!==p.value&&(p.value=e)})),d(w,(e=>{if(!o.value)return;let n=document.body.className;e?n.includes("img-viewr__body-lock")||(n+=" img-viewr__body-lock"):n=n.replace("img-viewr__body-lock",""),document.body.className=n.trim()})),d(p,(e=>{var l;W(),null==(l=h.value)||l.call(h,e),n("switch",e)})),d(Y,(()=>{m((()=>{const e=C.value;e&&e.complete||(k.value=!0)}))}));const H=()=>{var e;null==(e=f.value)||e.call(f),n("close")};let P,V,B;const W=()=>{I.scale=1,I.deg=0,I.offsetX=0,I.offsetY=0,I.enableTransition=!1},U=()=>{if(k.value)return;const e=Object.keys(E),n=(Object.values(E).findIndex((({name:e})=>e===y.name))+1)%e.length,{name:l,icon:i}=E[e[n]];y.name=l,y.icon=i,W()},q=()=>{if(A.value&&!b.value)return;const e=_.value.length;p.value=(p.value-1+e)%e},G=()=>{if(X.value&&!b.value)return;const e=_.value.length;p.value=(p.value+1)%e},J=(e,n={})=>{if(k.value)return;const{zoomRate:l,rotateDeg:i,enableTransition:o}=a({zoomRate:.2,rotateDeg:90,enableTransition:!0},n);switch(e){case"zoomOut":I.scale>.2&&(I.scale=parseFloat((I.scale-l).toFixed(3)));break;case"zoomIn":I.scale=parseFloat((I.scale+l).toFixed(3));break;case"clocelise":I.deg+=i;break;case"anticlocelise":I.deg-=i;break;case"download":((e,n,l)=>{const i=new Image,o=document.createElement("canvas"),a=o.getContext("2d"),t=document.createElement("a");i.setAttribute("crossOrigin","anonymous"),i.src=e,i.onerror=()=>{window.open(e)},i.onload=()=>{o.width=i.width,o.height=i.height,null==a||a.drawImage(i,0,0,i.width,i.height),t.setAttribute("href",o.toDataURL(`image/${l}`)),t.setAttribute("target","_blank"),t.setAttribute("download",`${n}.${l}`),t.click()}})(Y.value,Date.now().toString(),"png")}I.enableTransition=o};return v((()=>{var e,n;P=M((e=>{switch(e.code){case D:H();break;case F:U();break;case L:q();break;case T:J("zoomIn");break;case $:G();break;case R:J("zoomOut")}})),V=M((e=>{const n=e.wheelDelta?e.wheelDelta:-e.detail;J(n>0?"zoomIn":"zoomOut",{zoomRate:.05,enableTransition:!1})})),z(document,"keydown",P),z(document,N,V),null==(n=null==(e=null==x?void 0:x.value)?void 0:e.focus)||n.call(e)})),g((()=>{P&&S(document,"keydown",P),V&&S(document,N,V),P=null,V=null})),{images:_,isShow:w,initIndex:l,zIndexNum:i,isLockScroll:o,isCloseOnClickMask:t,imgViewrWrapper:x,imageRef:C,index:p,isSingle:O,infinite:b,isFirst:A,isLast:X,mode:y,currentImg:Y,imgStyle:j,closeHandle:f,switchHandle:h,hide:H,prev:q,next:G,toggleMode:U,handleActions:J,handleMaskClick:()=>{t.value&&H()},handleImgLoad:()=>{k.value=!1},handleImgError:()=>{k.value=!1;const e=C.value;e&&(e.alt="加载失败")},handleMouseDown:e=>{if(k.value||0!==e.button)return;const{offsetX:n,offsetY:l}=I,i=e.pageX,o=e.pageY;B=M((e=>{I.offsetX=n+e.pageX-i,I.offsetY=l+e.pageY-o})),z(document,"mousemove",B),z(document,"mouseup",(()=>{B&&S(document,"mousemove",B)})),e.preventDefault()}}}});const Y=b("i",{class:"img-viewr__icon icon__circle-close"},null,-1),j=b("i",{class:"img-viewr__icon icon__arrow-left"},null,-1),H=b("i",{class:"img-viewr__icon icon__arrow-right"},null,-1),P={class:"img-viewr__btn img-viewr__actions"},V={class:"img-viewr__actions__inner"},B=b("i",{class:"img-viewr__actions__divider"},null,-1),W=b("i",{class:"img-viewr__actions__divider"},null,-1),U=b("i",{class:"img-viewr__actions__divider"},null,-1),q={class:"img-viewr__canvas"};X.render=function(e,n,l,i,o,a){return w(),_(f,{name:"img-viewr-fade"},{default:h((()=>[p(b("div",{tabindex:"-1",ref:"imgViewrWrapper",class:"img-viewr__wrapper",style:`z-index: ${e.zIndexNum}`},[b("div",{class:"img-viewr__mask",onClick:n[1]||(n[1]=k(((...n)=>e.handleMaskClick&&e.handleMaskClick(...n)),["self"]))}),b("span",{class:"img-viewr__btn img-viewr__close",onClick:n[2]||(n[2]=(...n)=>e.hide&&e.hide(...n))},[Y]),e.isSingle?I("",!0):(w(),_(y,{key:0},[b("span",{class:["img-viewr__btn img-viewr__prev",{"is-disabled":!e.infinite&&e.isFirst}],onClick:n[3]||(n[3]=(...n)=>e.prev&&e.prev(...n))},[j],2),b("span",{class:["img-viewr__btn img-viewr__next",{"is-disabled":!e.infinite&&e.isLast}],onClick:n[4]||(n[4]=(...n)=>e.next&&e.next(...n))},[H],2)],64)),b("div",P,[b("div",V,[b("i",{class:"img-viewr__icon icon__zoom-out",onClick:n[5]||(n[5]=n=>e.handleActions("zoomOut"))}),b("i",{class:"img-viewr__icon icon__zoom-in",onClick:n[6]||(n[6]=n=>e.handleActions("zoomIn"))}),B,b("i",{class:e.mode.icon,onClick:n[7]||(n[7]=(...n)=>e.toggleMode&&e.toggleMode(...n))},null,2),W,b("i",{class:"img-viewr__icon icon__download-image",onClick:n[8]||(n[8]=n=>e.handleActions("download"))}),U,b("i",{class:"img-viewr__icon icon__refresh-left",onClick:n[9]||(n[9]=n=>e.handleActions("anticlocelise"))}),b("i",{class:"img-viewr__icon icon__refresh-right",onClick:n[10]||(n[10]=n=>e.handleActions("clocelise"))})])]),b("div",q,[(w(!0),_(y,null,x(e.images,((l,i)=>(w(),_(y,null,[i===e.index?(w(),_("img",{class:"img-viewr__img",ref:"imageRef",key:l,src:e.currentImg,style:e.imgStyle,onLoad:n[11]||(n[11]=(...n)=>e.handleImgLoad&&e.handleImgLoad(...n)),onError:n[12]||(n[12]=(...n)=>e.handleImgError&&e.handleImgError(...n)),onMousedown:n[13]||(n[13]=(...n)=>e.handleMouseDown&&e.handleMouseDown(...n))},null,44,["src"])):I("",!0)],64)))),256))])],4),[[C,e.isShow]])])),_:1})};const G="undefined"==typeof window;let J;const K=e=>{var n,l,i,o,a;if(G)return;if(!(e.urls&&e.urls.length>0))throw new Error("At least one picture in urls array!");J||(()=>{const e=document.createElement("div"),n=b(X,{});n&&n.props&&(n.props.onDestroy=()=>{O(null,e)}),O(n,e),J=n,e.firstElementChild&&document.body.appendChild(e.firstElementChild)})();const t=null==(n=null==J?void 0:J.component)?void 0:n.proxy;t.images=e.urls,t.initIndex=null!=(l=e.index)?l:0,t.zIndexNum=null!=(i=e.zIndex)?i:3e3,t.isLockScroll=null==(o=e.lockScroll)||o,t.isCloseOnClickMask=null==(a=e.closeOnClickMask)||a,t.closeHandle=()=>{var n;t.isShow=!1,null==(n=e.onClose)||n.call(e)},t.switchHandle=n=>{var l;null==(l=e.onSwitch)||l.call(e,n)},setTimeout((()=>{t.isShow=!0}),0)};X.install=e=>{e.config.globalProperties.$showImages=K,e.component(X.name,X)};export default X;export{X as ImgViewr,K as showImages};
