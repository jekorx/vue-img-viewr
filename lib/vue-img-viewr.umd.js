var __defProp=Object.defineProperty,__hasOwnProp=Object.prototype.hasOwnProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,o,n)=>o in e?__defProp(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,__assign=(e,o)=>{for(var n in o||(o={}))__hasOwnProp.call(o,n)&&__defNormalProp(e,n,o[n]);if(__getOwnPropSymbols)for(var n of __getOwnPropSymbols(o))__propIsEnum.call(o,n)&&__defNormalProp(e,n,o[n]);return e};!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],o):o((e="undefined"!=typeof globalThis?globalThis:e||self)["vue-img-viewr"]={},e.Vue)}(this,(function(e,o){"use strict";const n="undefined"==typeof window,l=(e,o,l,i=!1)=>{!n&&e&&o&&l&&e.addEventListener(o,l,i)},i=(e,o,l,i=!1)=>{!n&&e&&o&&l&&e.removeEventListener(o,l,i)};function a(e){let o=!1;return function(...n){o||(o=!0,window.requestAnimationFrame((()=>{e.apply(this,n),o=!1})))}}const t={CONTAIN:{name:"contain",icon:"img-viewr__icon icon__full-screen"},ORIGINAL:{name:"original",icon:"img-viewr__icon icon__scale-to-original"}},r=!n&&window.navigator.userAgent.match(/firefox/i)?"DOMMouseScroll":"mousewheel",s="close",c="switch",d="show",u="Escape",m="ArrowLeft",v="ArrowUp",g="ArrowRight",_="ArrowDown",f="Space";var w=o.defineComponent({name:"ImgViewr",props:{visible:{type:Boolean,default:!1},urls:{type:Array,default:()=>[]},zIndex:{type:Number,default:3e3},initialIndex:{type:Number,default:0},lockScroll:{type:Boolean,default:!0},closeOnClickMask:{type:Boolean,default:!0}},emits:[s,c,d],setup(e,{emit:n}){const w=o.ref(0),p=o.ref(3e3),h=o.ref(!0),k=o.ref(!0),b=o.ref(!1),y=o.ref([]),I=o.ref(null),N=o.ref(null),x=o.ref(null),C=o.ref(0),O=o.ref(!0),V=o.ref(!1),S=o.reactive(__assign({},t.CONTAIN)),A=o.reactive({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),M=o.ref(null),z=o.ref(null),E=o.computed((()=>y.value.length<=1)),T=o.computed((()=>0===C.value)),L=o.computed((()=>C.value===y.value.length-1)),P=o.computed((()=>y.value[C.value]||y.value[0])),B=o.computed((()=>{const{scale:e,deg:o,offsetX:n,offsetY:l,enableTransition:i}=A,a={transform:`scale(${e}) rotate(${o}deg)`,transition:i?"transform .3s":"","margin-left":`${n}px`,"margin-top":`${l}px`};return S.name===t.CONTAIN.name&&(a.maxWidth=a.maxHeight="100%"),a}));o.watchEffect((()=>{e.urls.length&&(y.value=e.urls,w.value=e.initialIndex,p.value=e.zIndex,h.value=e.lockScroll,k.value=e.closeOnClickMask)})),o.watch((()=>e.visible),(e=>{b.value=e})),o.watch(w,(e=>{e!==C.value&&(C.value=e)})),o.watch(b,(e=>{var o;if(!h.value)return;const l=document.body.classList;e?(R(),l.contains("img-viewr__body-lock")||l.add("img-viewr__body-lock")):l.contains("img-viewr__body-lock")&&l.remove("img-viewr__body-lock"),null==(o=x.value)||o.call(x,e),n(d,e)})),o.watch(C,(e=>{var o;R(),null==(o=N.value)||o.call(N,e),n(c,e)})),o.watch(P,(()=>{o.nextTick((()=>{const e=z.value;e&&e.complete||(V.value=!0)}))}));const D=()=>{var e;null==(e=I.value)||e.call(I),n(s)};let F,$,j;const R=()=>{A.scale=1,A.deg=0,A.offsetX=0,A.offsetY=0,A.enableTransition=!1},H=()=>{if(V.value)return;const e=Object.keys(t),o=(Object.values(t).findIndex((({name:e})=>e===S.name))+1)%e.length,{name:n,icon:l}=t[e[o]];S.name=n,S.icon=l,R()},X=()=>{if(T.value&&!O.value)return;const e=y.value.length;C.value=(C.value-1+e)%e},Y=()=>{if(L.value&&!O.value)return;const e=y.value.length;C.value=(C.value+1)%e},U=(e,o={})=>{if(V.value)return;const{zoomRate:n,rotateDeg:l,enableTransition:i}=__assign({zoomRate:.2,rotateDeg:90,enableTransition:!0},o);switch(e){case"zoomOut":A.scale>.2&&(A.scale=parseFloat((A.scale-n).toFixed(3)));break;case"zoomIn":A.scale=parseFloat((A.scale+n).toFixed(3));break;case"clocelise":A.deg+=l;break;case"anticlocelise":A.deg-=l;break;case"download":((e,o,n)=>{const l=new Image,i=document.createElement("canvas"),a=i.getContext("2d"),t=document.createElement("a");l.setAttribute("crossOrigin","anonymous"),l.src=e,l.onerror=()=>{window.open(e)},l.onload=()=>{i.width=l.width,i.height=l.height,null==a||a.drawImage(l,0,0,l.width,l.height),t.setAttribute("href",i.toDataURL(`image/${n}`)),t.setAttribute("target","_blank"),t.setAttribute("download",`${o}.${n}`),t.click()}})(P.value,Date.now().toString(),"png")}A.enableTransition=i};return o.onMounted((()=>{var e,o;F=a((e=>{switch(e.code){case u:D();break;case f:H();break;case m:X();break;case v:U("zoomIn");break;case g:Y();break;case _:U("zoomOut")}})),$=a((e=>{const o=e.wheelDelta?e.wheelDelta:-e.detail;U(o>0?"zoomIn":"zoomOut",{zoomRate:.05,enableTransition:!1})})),l(document,"keydown",F),l(document,r,$),null==(o=null==(e=null==M?void 0:M.value)?void 0:e.focus)||o.call(e)})),o.onBeforeUnmount((()=>{F&&i(document,"keydown",F),$&&i(document,r,$),F=null,$=null})),{images:y,isShow:b,initIndex:w,zIndexNum:p,isLockScroll:h,isCloseOnClickMask:k,imgViewrWrapper:M,imageRef:z,index:C,isSingle:E,infinite:O,isFirst:T,isLast:L,mode:S,currentImg:P,imgStyle:B,closeHandle:I,switchHandle:N,showHandle:x,hide:D,prev:X,next:Y,toggleMode:H,handleActions:U,handleMaskClick:()=>{k.value&&D()},handleImgLoad:()=>{V.value=!1},handleImgError:()=>{V.value=!1;const e=z.value;e&&(e.alt="加载失败")},handleMouseDown:e=>{if(V.value||0!==e.button)return;const{offsetX:o,offsetY:n}=A,t=e.pageX,r=e.pageY;j=a((e=>{A.offsetX=o+e.pageX-t,A.offsetY=n+e.pageY-r})),l(document,"mousemove",j),l(document,"mouseup",(()=>{j&&i(document,"mousemove",j)})),e.preventDefault()}}}});const p=o.createVNode("i",{class:"img-viewr__icon icon__circle-close"},null,-1),h=o.createVNode("i",{class:"img-viewr__icon icon__arrow-left"},null,-1),k=o.createVNode("i",{class:"img-viewr__icon icon__arrow-right"},null,-1),b={class:"img-viewr__btn img-viewr__actions"},y={class:"img-viewr__actions__inner"},I=o.createVNode("i",{class:"img-viewr__actions__divider"},null,-1),N=o.createVNode("i",{class:"img-viewr__actions__divider"},null,-1),x=o.createVNode("i",{class:"img-viewr__actions__divider"},null,-1),C={class:"img-viewr__canvas"};w.render=function(e,n,l,i,a,t){return o.openBlock(),o.createBlock(o.Transition,{name:"img-viewr-fade"},{default:o.withCtx((()=>[o.withDirectives(o.createVNode("div",{tabindex:"-1",ref:"imgViewrWrapper",class:"img-viewr__wrapper",style:`z-index: ${e.zIndexNum}`},[o.createVNode("div",{class:"img-viewr__mask",onClick:n[1]||(n[1]=o.withModifiers(((...o)=>e.handleMaskClick&&e.handleMaskClick(...o)),["self"]))}),o.createVNode("span",{class:"img-viewr__btn img-viewr__close",onClick:n[2]||(n[2]=(...o)=>e.hide&&e.hide(...o))},[p]),e.isSingle?o.createCommentVNode("",!0):(o.openBlock(),o.createBlock(o.Fragment,{key:0},[o.createVNode("span",{class:["img-viewr__btn img-viewr__prev",{"is-disabled":!e.infinite&&e.isFirst}],onClick:n[3]||(n[3]=(...o)=>e.prev&&e.prev(...o))},[h],2),o.createVNode("span",{class:["img-viewr__btn img-viewr__next",{"is-disabled":!e.infinite&&e.isLast}],onClick:n[4]||(n[4]=(...o)=>e.next&&e.next(...o))},[k],2)],64)),o.createVNode("div",b,[o.createVNode("div",y,[o.createVNode("i",{class:"img-viewr__icon icon__zoom-out",onClick:n[5]||(n[5]=o=>e.handleActions("zoomOut"))}),o.createVNode("i",{class:"img-viewr__icon icon__zoom-in",onClick:n[6]||(n[6]=o=>e.handleActions("zoomIn"))}),I,o.createVNode("i",{class:e.mode.icon,onClick:n[7]||(n[7]=(...o)=>e.toggleMode&&e.toggleMode(...o))},null,2),N,o.createVNode("i",{class:"img-viewr__icon icon__download-image",onClick:n[8]||(n[8]=o=>e.handleActions("download"))}),x,o.createVNode("i",{class:"img-viewr__icon icon__refresh-left",onClick:n[9]||(n[9]=o=>e.handleActions("anticlocelise"))}),o.createVNode("i",{class:"img-viewr__icon icon__refresh-right",onClick:n[10]||(n[10]=o=>e.handleActions("clocelise"))})])]),o.createVNode("div",C,[(o.openBlock(!0),o.createBlock(o.Fragment,null,o.renderList(e.images,((l,i)=>(o.openBlock(),o.createBlock(o.Fragment,null,[i===e.index?(o.openBlock(),o.createBlock("img",{class:"img-viewr__img",ref:"imageRef",key:l,src:e.currentImg,style:e.imgStyle,onLoad:n[11]||(n[11]=(...o)=>e.handleImgLoad&&e.handleImgLoad(...o)),onError:n[12]||(n[12]=(...o)=>e.handleImgError&&e.handleImgError(...o)),onMousedown:n[13]||(n[13]=(...o)=>e.handleMouseDown&&e.handleMouseDown(...o))},null,44,["src"])):o.createCommentVNode("",!0)],64)))),256))])],4),[[o.vShow,e.isShow]])])),_:1})};const O="undefined"==typeof window;let V;const S=e=>{var n,l,i,a,t;if(O)return;if(!(e.urls&&e.urls.length>0))throw new Error("At least one picture in urls array!");V||(()=>{const e=document.createElement("div"),n=o.createVNode(w,{});n&&n.props&&(n.props.onDestroy=()=>{o.render(null,e)}),o.render(n,e),V=n,e.firstElementChild&&document.body.appendChild(e.firstElementChild)})();const r=null==(n=null==V?void 0:V.component)?void 0:n.proxy;r.images=e.urls,r.initIndex=null!=(l=e.index)?l:0,r.zIndexNum=null!=(i=e.zIndex)?i:3e3,r.isLockScroll=null==(a=e.lockScroll)||a,r.isCloseOnClickMask=null==(t=e.closeOnClickMask)||t,r.closeHandle=()=>{var o;r.isShow=!1,null==(o=e.onClose)||o.call(e)},r.switchHandle=o=>{var n;null==(n=e.onSwitch)||n.call(e,o)},r.showHandle=o=>{var n;null==(n=e.onShow)||n.call(e,o)},setTimeout((()=>{r.isShow=!0}),0)};w.showImages=S,w.install=e=>{e.config.globalProperties.$showImages=S,e.component(w.name,w)},e.ImgViewr=w,e.default=w,e.showImages=S,Object.defineProperty(e,"__esModule",{value:!0}),e[Symbol.toStringTag]="Module"}));
