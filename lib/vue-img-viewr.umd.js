var __defProp=Object.defineProperty,__hasOwnProp=Object.prototype.hasOwnProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,o,n)=>o in e?__defProp(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,__assign=(e,o)=>{for(var n in o||(o={}))__hasOwnProp.call(o,n)&&__defNormalProp(e,n,o[n]);if(__getOwnPropSymbols)for(var n of __getOwnPropSymbols(o))__propIsEnum.call(o,n)&&__defNormalProp(e,n,o[n]);return e};!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],o):o((e="undefined"!=typeof globalThis?globalThis:e||self).ImgViewr={},e.Vue)}(this,(function(e,o){"use strict";const n="undefined"==typeof window,i=(e,o,i,t=!1)=>{!n&&e&&o&&i&&e.addEventListener(o,i,t)},t=(e,o,i,t=!1)=>{!n&&e&&o&&i&&e.removeEventListener(o,i,t)};function l(e){let o=!1;return function(...n){o||(o=!0,window.requestAnimationFrame((()=>{e.apply(this,n),o=!1})))}}const r={CONTAIN:{name:"contain",icon:"img-viewr__icon icon__full-screen"},ORIGINAL:{name:"original",icon:"img-viewr__icon icon__scale-to-original"}},a=!n&&window.navigator.userAgent.match(/firefox/i)?"DOMMouseScroll":"mousewheel",s="close",c="switch",d="Escape",u="ArrowLeft",m="ArrowUp",_="ArrowRight",g="ArrowDown",p="Space";var f=o.defineComponent({props:{visible:{type:Boolean,default:!1},urls:{type:Array,default:()=>[]},zIndex:{type:Number,default:3e3},initialIndex:{type:Number,default:0},lockScroll:{type:Boolean,default:!0},closeOnClickMask:{type:Boolean,default:!0}},emits:[s,c],setup(e,{emit:n}){const f=o.ref(0),v=o.ref(!0),w=o.ref(!1),h=o.reactive(__assign({},r.CONTAIN)),k=o.reactive({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),b=o.ref(null),y=o.ref(null),N=o.computed((()=>e.urls.length<=1)),x=o.computed((()=>0===f.value)),I=o.computed((()=>f.value===e.urls.length-1)),C=o.computed((()=>e.urls[f.value]||e.urls[0])),V=o.computed((()=>{const{scale:e,deg:o,offsetX:n,offsetY:i,enableTransition:t}=k,l={transform:`scale(${e}) rotate(${o}deg)`,transition:t?"transform .3s":"","margin-left":`${n}px`,"margin-top":`${i}px`};return h.name===r.CONTAIN.name&&(l.maxWidth=l.maxHeight="100%"),l}));o.watch((()=>e.initialIndex),(e=>{e!==f.value&&(f.value=e)})),o.watch(f,(e=>{z(),n(c,e)})),o.watch(C,(()=>{o.nextTick((()=>{const e=y.value;e&&e.complete||(w.value=!0)}))})),o.watch((()=>e.visible),(o=>{if(!e.lockScroll)return;let n=document.body.className;o?n.includes("img-viewr__body-lock")||(n+=" img-viewr__body-lock"):n=n.replace("img-viewr__body-lock",""),document.body.className=n.trim()}));const O=()=>{n(s)};let A,M,S;const z=()=>{k.scale=1,k.deg=0,k.offsetX=0,k.offsetY=0,k.enableTransition=!1},B=()=>{if(w.value)return;const e=Object.keys(r),o=(Object.values(r).findIndex((({name:e})=>e===h.name))+1)%e.length,{name:n,icon:i}=r[e[o]];h.name=n,h.icon=i,z()},E=()=>{if(x.value&&!v.value)return;const o=e.urls.length;f.value=(f.value-1+o)%o},T=()=>{if(I.value&&!v.value)return;const o=e.urls.length;f.value=(f.value+1)%o},D=(e,o={})=>{if(w.value)return;const{zoomRate:n,rotateDeg:i,enableTransition:t}=__assign({zoomRate:.2,rotateDeg:90,enableTransition:!0},o);switch(e){case"zoomOut":k.scale>.2&&(k.scale=parseFloat((k.scale-n).toFixed(3)));break;case"zoomIn":k.scale=parseFloat((k.scale+n).toFixed(3));break;case"clocelise":k.deg+=i;break;case"anticlocelise":k.deg-=i;break;case"download":((e,o,n)=>{const i=new Image,t=document.createElement("canvas"),l=t.getContext("2d"),r=document.createElement("a");i.setAttribute("crossOrigin","anonymous"),i.src=e,i.onerror=()=>{window.open(e)},i.onload=()=>{t.width=i.width,t.height=i.height,null==l||l.drawImage(i,0,0,i.width,i.height),r.setAttribute("href",t.toDataURL(`image/${n}`)),r.setAttribute("target","_blank"),r.setAttribute("download",`${o}.${n}`),r.click()}})(C.value,Date.now().toString(),"png")}k.enableTransition=t};return o.onMounted((()=>{var e;A=l((e=>{switch(e.code){case d:O();break;case p:B();break;case u:E();break;case m:D("zoomIn");break;case _:T();break;case g:D("zoomOut")}})),M=l((e=>{const o=e.wheelDelta?e.wheelDelta:-e.detail;D(o>0?"zoomIn":"zoomOut",{zoomRate:.05,enableTransition:!1})})),i(document,"keydown",A),i(document,a,M),null==(e=null==b?void 0:b.value)||e.focus()})),o.onBeforeUnmount((()=>{A&&t(document,"keydown",A),M&&t(document,a,M),A=null,M=null})),{imgViewrWrapper:b,imageRef:y,index:f,isSingle:N,infinite:v,isFirst:x,isLast:I,mode:h,currentImg:C,imgStyle:V,hide:O,prev:E,next:T,toggleMode:B,handleActions:D,handleMaskClick:()=>{e.closeOnClickMask&&O()},handleImgLoad:()=>{w.value=!1},handleImgError:()=>{w.value=!1;const e=y.value;e&&(e.alt="加载失败")},handleMouseDown:e=>{if(w.value||0!==e.button)return;const{offsetX:o,offsetY:n}=k,r=e.pageX,a=e.pageY;S=l((e=>{k.offsetX=o+e.pageX-r,k.offsetY=n+e.pageY-a})),i(document,"mousemove",S),i(document,"mouseup",(()=>{S&&t(document,"mousemove",S)})),e.preventDefault()}}}});const v=o.createVNode("i",{class:"img-viewr__icon icon__circle-close"},null,-1),w=o.createVNode("i",{class:"img-viewr__icon icon__arrow-left"},null,-1),h=o.createVNode("i",{class:"img-viewr__icon icon__arrow-right"},null,-1),k={class:"img-viewr__btn img-viewr__actions"},b={class:"img-viewr__actions__inner"},y=o.createVNode("i",{class:"img-viewr__actions__divider"},null,-1),N=o.createVNode("i",{class:"img-viewr__actions__divider"},null,-1),x=o.createVNode("i",{class:"img-viewr__actions__divider"},null,-1),I={class:"img-viewr__canvas"};f.render=function(e,n,i,t,l,r){return o.openBlock(),o.createBlock(o.Transition,{name:"img-viewr-fade"},{default:o.withCtx((()=>[o.withDirectives(o.createVNode("div",{tabindex:"-1",ref:"imgViewrWrapper",class:"img-viewr__wrapper",style:`z-index: ${e.zIndex}`},[o.createVNode("div",{class:"img-viewr__mask",onClick:n[1]||(n[1]=o.withModifiers(((...o)=>e.handleMaskClick&&e.handleMaskClick(...o)),["self"]))}),o.createVNode("span",{class:"img-viewr__btn img-viewr__close",onClick:n[2]||(n[2]=(...o)=>e.hide&&e.hide(...o))},[v]),e.isSingle?o.createCommentVNode("",!0):(o.openBlock(),o.createBlock(o.Fragment,{key:0},[o.createVNode("span",{class:["img-viewr__btn img-viewr__prev",{"is-disabled":!e.infinite&&e.isFirst}],onClick:n[3]||(n[3]=(...o)=>e.prev&&e.prev(...o))},[w],2),o.createVNode("span",{class:["img-viewr__btn img-viewr__next",{"is-disabled":!e.infinite&&e.isLast}],onClick:n[4]||(n[4]=(...o)=>e.next&&e.next(...o))},[h],2)],64)),o.createVNode("div",k,[o.createVNode("div",b,[o.createVNode("i",{class:"img-viewr__icon icon__zoom-out",onClick:n[5]||(n[5]=o=>e.handleActions("zoomOut"))}),o.createVNode("i",{class:"img-viewr__icon icon__zoom-in",onClick:n[6]||(n[6]=o=>e.handleActions("zoomIn"))}),y,o.createVNode("i",{class:e.mode.icon,onClick:n[7]||(n[7]=(...o)=>e.toggleMode&&e.toggleMode(...o))},null,2),N,o.createVNode("i",{class:"img-viewr__icon icon__download-image",onClick:n[8]||(n[8]=o=>e.handleActions("download"))}),x,o.createVNode("i",{class:"img-viewr__icon icon__refresh-left",onClick:n[9]||(n[9]=o=>e.handleActions("anticlocelise"))}),o.createVNode("i",{class:"img-viewr__icon icon__refresh-right",onClick:n[10]||(n[10]=o=>e.handleActions("clocelise"))})])]),o.createVNode("div",I,[(o.openBlock(!0),o.createBlock(o.Fragment,null,o.renderList(e.urls,((i,t)=>(o.openBlock(),o.createBlock(o.Fragment,null,[t===e.index?(o.openBlock(),o.createBlock("img",{class:"img-viewr__img",ref:"imageRef",key:i,src:e.currentImg,style:e.imgStyle,onLoad:n[11]||(n[11]=(...o)=>e.handleImgLoad&&e.handleImgLoad(...o)),onError:n[12]||(n[12]=(...o)=>e.handleImgError&&e.handleImgError(...o)),onMousedown:n[13]||(n[13]=(...o)=>e.handleMouseDown&&e.handleMouseDown(...o))},null,44,["src"])):o.createCommentVNode("",!0)],64)))),256))])],4),[[o.vShow,e.visible]])])),_:1})};var C={name:"Wrap",components:{ImgViewr:f},setup(){const e=o.reactive({visible:!1,lockScroll:!0,closeOnClickMask:!0,urls:[],index:0,zIndex:3e3,onClose(){},onSwitch(e){}});return{options:e,close:()=>{e.visible=!1,setTimeout((()=>{e.urls=[],null==e||e.onClose()}),300)},change:o=>{e.onSwitch(o)}}}};C.render=function(e,n,i,t,l,r){const a=o.resolveComponent("ImgViewr");return o.openBlock(),o.createBlock(a,{visible:t.options.visible,urls:t.options.urls,"initial-index":t.options.index,"z-index":t.options.zIndex,"lock-scroll":t.options.lockScroll,"close-on-clickMask":t.options.closeOnClickMask,onClose:t.close,onSwitch:t.change},null,8,["visible","urls","initial-index","z-index","lock-scroll","close-on-clickMask","onClose","onSwitch"])};const V="undefined"==typeof window;let O;e.ImgViewr=f,e.showImages=e=>{if(!V){if(!(e.urls&&e.urls.length>0))throw new Error("At least one picture in urls array!");O||(()=>{const e=document.createElement("div"),n=o.createVNode(C,{});n&&n.props&&(n.props.onDestroy=()=>{o.render(null,e)}),o.render(n,e),O=n,e.firstElementChild&&document.body.appendChild(e.firstElementChild)})();for(const o in e)O.component.proxy.options[o]=e[o];O.component.proxy.options.visible=!0}},Object.defineProperty(e,"__esModule",{value:!0}),e[Symbol.toStringTag]="Module"}));
