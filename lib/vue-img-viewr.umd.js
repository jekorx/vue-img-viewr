var __defProp=Object.defineProperty,__hasOwnProp=Object.prototype.hasOwnProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,o,n)=>o in e?__defProp(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,__assign=(e,o)=>{for(var n in o||(o={}))__hasOwnProp.call(o,n)&&__defNormalProp(e,n,o[n]);if(__getOwnPropSymbols)for(var n of __getOwnPropSymbols(o))__propIsEnum.call(o,n)&&__defNormalProp(e,n,o[n]);return e};!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],o):o((e="undefined"!=typeof globalThis?globalThis:e||self)["vue-img-viewr"]={},e.Vue)}(this,(function(e,o){"use strict";const n="undefined"==typeof window,i=(e,o,i,l=!1)=>{!n&&e&&o&&i&&e.addEventListener(o,i,l)},l=(e,o,i,l=!1)=>{!n&&e&&o&&i&&e.removeEventListener(o,i,l)};function t(e){let o=!1;return function(...n){o||(o=!0,window.requestAnimationFrame((()=>{e.apply(this,n),o=!1})))}}const a={CONTAIN:{name:"contain",icon:"img-viewr__icon icon__full-screen"},ORIGINAL:{name:"original",icon:"img-viewr__icon icon__scale-to-original"}},r=!n&&window.navigator.userAgent.match(/firefox/i)?"DOMMouseScroll":"mousewheel",c="close",s="switch",d="Escape",u="ArrowLeft",m="ArrowUp",g="ArrowRight",_="ArrowDown",v="Space";var f=o.defineComponent({name:"ImgViewr",props:{visible:{type:Boolean,default:!1},urls:{type:Array,default:()=>[]},zIndex:{type:Number,default:3e3},initialIndex:{type:Number,default:0},lockScroll:{type:Boolean,default:!0},closeOnClickMask:{type:Boolean,default:!0}},emits:[c,s],setup(e,{emit:n}){const f=o.ref(0),w=o.ref(3e3),p=o.ref(!0),h=o.ref(!0),k=o.ref(!1),b=o.ref([]),y=o.ref(null),N=o.ref(null),I=o.ref(0),x=o.ref(!0),C=o.ref(!1),O=o.reactive(__assign({},a.CONTAIN)),V=o.reactive({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),S=o.ref(null),A=o.ref(null),M=o.computed((()=>b.value.length<=1)),z=o.computed((()=>0===I.value)),E=o.computed((()=>I.value===b.value.length-1)),T=o.computed((()=>b.value[I.value]||b.value[0])),P=o.computed((()=>{const{scale:e,deg:o,offsetX:n,offsetY:i,enableTransition:l}=V,t={transform:`scale(${e}) rotate(${o}deg)`,transition:l?"transform .3s":"","margin-left":`${n}px`,"margin-top":`${i}px`};return O.name===a.CONTAIN.name&&(t.maxWidth=t.maxHeight="100%"),t}));o.watchEffect((()=>{e.urls.length&&(b.value=e.urls,f.value=e.initialIndex,w.value=e.zIndex,p.value=e.lockScroll,h.value=e.closeOnClickMask)})),o.watch((()=>e.visible),(e=>{k.value=e})),o.watch(f,(e=>{e!==I.value&&(I.value=e)})),o.watch(k,(e=>{if(!p.value)return;let o=document.body.className;e?o.includes("img-viewr__body-lock")||(o+=" img-viewr__body-lock"):o=o.replace("img-viewr__body-lock",""),document.body.className=o.trim()})),o.watch(I,(e=>{var o;$(),null==(o=N.value)||o.call(N,e),n(s,e)})),o.watch(T,(()=>{o.nextTick((()=>{const e=A.value;e&&e.complete||(C.value=!0)}))}));const B=()=>{var e;null==(e=y.value)||e.call(y),n(c)};let D,L,F;const $=()=>{V.scale=1,V.deg=0,V.offsetX=0,V.offsetY=0,V.enableTransition=!1},j=()=>{if(C.value)return;const e=Object.keys(a),o=(Object.values(a).findIndex((({name:e})=>e===O.name))+1)%e.length,{name:n,icon:i}=a[e[o]];O.name=n,O.icon=i,$()},R=()=>{if(z.value&&!x.value)return;const e=b.value.length;I.value=(I.value-1+e)%e},X=()=>{if(E.value&&!x.value)return;const e=b.value.length;I.value=(I.value+1)%e},Y=(e,o={})=>{if(C.value)return;const{zoomRate:n,rotateDeg:i,enableTransition:l}=__assign({zoomRate:.2,rotateDeg:90,enableTransition:!0},o);switch(e){case"zoomOut":V.scale>.2&&(V.scale=parseFloat((V.scale-n).toFixed(3)));break;case"zoomIn":V.scale=parseFloat((V.scale+n).toFixed(3));break;case"clocelise":V.deg+=i;break;case"anticlocelise":V.deg-=i;break;case"download":((e,o,n)=>{const i=new Image,l=document.createElement("canvas"),t=l.getContext("2d"),a=document.createElement("a");i.setAttribute("crossOrigin","anonymous"),i.src=e,i.onerror=()=>{window.open(e)},i.onload=()=>{l.width=i.width,l.height=i.height,null==t||t.drawImage(i,0,0,i.width,i.height),a.setAttribute("href",l.toDataURL(`image/${n}`)),a.setAttribute("target","_blank"),a.setAttribute("download",`${o}.${n}`),a.click()}})(T.value,Date.now().toString(),"png")}V.enableTransition=l};return o.onMounted((()=>{var e,o;D=t((e=>{switch(e.code){case d:B();break;case v:j();break;case u:R();break;case m:Y("zoomIn");break;case g:X();break;case _:Y("zoomOut")}})),L=t((e=>{const o=e.wheelDelta?e.wheelDelta:-e.detail;Y(o>0?"zoomIn":"zoomOut",{zoomRate:.05,enableTransition:!1})})),i(document,"keydown",D),i(document,r,L),null==(o=null==(e=null==S?void 0:S.value)?void 0:e.focus)||o.call(e)})),o.onBeforeUnmount((()=>{D&&l(document,"keydown",D),L&&l(document,r,L),D=null,L=null})),{images:b,isShow:k,initIndex:f,zIndexNum:w,isLockScroll:p,isCloseOnClickMask:h,imgViewrWrapper:S,imageRef:A,index:I,isSingle:M,infinite:x,isFirst:z,isLast:E,mode:O,currentImg:T,imgStyle:P,closeHandle:y,switchHandle:N,hide:B,prev:R,next:X,toggleMode:j,handleActions:Y,handleMaskClick:()=>{h.value&&B()},handleImgLoad:()=>{C.value=!1},handleImgError:()=>{C.value=!1;const e=A.value;e&&(e.alt="加载失败")},handleMouseDown:e=>{if(C.value||0!==e.button)return;const{offsetX:o,offsetY:n}=V,a=e.pageX,r=e.pageY;F=t((e=>{V.offsetX=o+e.pageX-a,V.offsetY=n+e.pageY-r})),i(document,"mousemove",F),i(document,"mouseup",(()=>{F&&l(document,"mousemove",F)})),e.preventDefault()}}}});const w=o.createVNode("i",{class:"img-viewr__icon icon__circle-close"},null,-1),p=o.createVNode("i",{class:"img-viewr__icon icon__arrow-left"},null,-1),h=o.createVNode("i",{class:"img-viewr__icon icon__arrow-right"},null,-1),k={class:"img-viewr__btn img-viewr__actions"},b={class:"img-viewr__actions__inner"},y=o.createVNode("i",{class:"img-viewr__actions__divider"},null,-1),N=o.createVNode("i",{class:"img-viewr__actions__divider"},null,-1),I=o.createVNode("i",{class:"img-viewr__actions__divider"},null,-1),x={class:"img-viewr__canvas"};f.render=function(e,n,i,l,t,a){return o.openBlock(),o.createBlock(o.Transition,{name:"img-viewr-fade"},{default:o.withCtx((()=>[o.withDirectives(o.createVNode("div",{tabindex:"-1",ref:"imgViewrWrapper",class:"img-viewr__wrapper",style:`z-index: ${e.zIndexNum}`},[o.createVNode("div",{class:"img-viewr__mask",onClick:n[1]||(n[1]=o.withModifiers(((...o)=>e.handleMaskClick&&e.handleMaskClick(...o)),["self"]))}),o.createVNode("span",{class:"img-viewr__btn img-viewr__close",onClick:n[2]||(n[2]=(...o)=>e.hide&&e.hide(...o))},[w]),e.isSingle?o.createCommentVNode("",!0):(o.openBlock(),o.createBlock(o.Fragment,{key:0},[o.createVNode("span",{class:["img-viewr__btn img-viewr__prev",{"is-disabled":!e.infinite&&e.isFirst}],onClick:n[3]||(n[3]=(...o)=>e.prev&&e.prev(...o))},[p],2),o.createVNode("span",{class:["img-viewr__btn img-viewr__next",{"is-disabled":!e.infinite&&e.isLast}],onClick:n[4]||(n[4]=(...o)=>e.next&&e.next(...o))},[h],2)],64)),o.createVNode("div",k,[o.createVNode("div",b,[o.createVNode("i",{class:"img-viewr__icon icon__zoom-out",onClick:n[5]||(n[5]=o=>e.handleActions("zoomOut"))}),o.createVNode("i",{class:"img-viewr__icon icon__zoom-in",onClick:n[6]||(n[6]=o=>e.handleActions("zoomIn"))}),y,o.createVNode("i",{class:e.mode.icon,onClick:n[7]||(n[7]=(...o)=>e.toggleMode&&e.toggleMode(...o))},null,2),N,o.createVNode("i",{class:"img-viewr__icon icon__download-image",onClick:n[8]||(n[8]=o=>e.handleActions("download"))}),I,o.createVNode("i",{class:"img-viewr__icon icon__refresh-left",onClick:n[9]||(n[9]=o=>e.handleActions("anticlocelise"))}),o.createVNode("i",{class:"img-viewr__icon icon__refresh-right",onClick:n[10]||(n[10]=o=>e.handleActions("clocelise"))})])]),o.createVNode("div",x,[(o.openBlock(!0),o.createBlock(o.Fragment,null,o.renderList(e.images,((i,l)=>(o.openBlock(),o.createBlock(o.Fragment,null,[l===e.index?(o.openBlock(),o.createBlock("img",{class:"img-viewr__img",ref:"imageRef",key:i,src:e.currentImg,style:e.imgStyle,onLoad:n[11]||(n[11]=(...o)=>e.handleImgLoad&&e.handleImgLoad(...o)),onError:n[12]||(n[12]=(...o)=>e.handleImgError&&e.handleImgError(...o)),onMousedown:n[13]||(n[13]=(...o)=>e.handleMouseDown&&e.handleMouseDown(...o))},null,44,["src"])):o.createCommentVNode("",!0)],64)))),256))])],4),[[o.vShow,e.isShow]])])),_:1})};const C="undefined"==typeof window;let O;const V=e=>{var n,i,l,t,a;if(C)return;if(!(e.urls&&e.urls.length>0))throw new Error("At least one picture in urls array!");O||(()=>{const e=document.createElement("div"),n=o.createVNode(f,{});n&&n.props&&(n.props.onDestroy=()=>{o.render(null,e)}),o.render(n,e),O=n,e.firstElementChild&&document.body.appendChild(e.firstElementChild)})();const r=null==(n=null==O?void 0:O.component)?void 0:n.proxy;r.images=e.urls,r.initIndex=null!=(i=e.index)?i:0,r.zIndexNum=null!=(l=e.zIndex)?l:3e3,r.isLockScroll=null==(t=e.lockScroll)||t,r.isCloseOnClickMask=null==(a=e.closeOnClickMask)||a,r.closeHandle=()=>{var o;r.isShow=!1,null==(o=e.onClose)||o.call(e)},r.switchHandle=o=>{var n;null==(n=e.onSwitch)||n.call(e,o)},setTimeout((()=>{r.isShow=!0}),0)};f.showImages=V,f.install=e=>{e.config.globalProperties.$showImages=V,e.component(f.name,f)},e.ImgViewr=f,e.default=f,e.showImages=V,Object.defineProperty(e,"__esModule",{value:!0}),e[Symbol.toStringTag]="Module"}));
